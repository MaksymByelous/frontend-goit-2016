angular.module("app.config", [])

.constant("appSettings", {
	"DEV": true,
	"API": {
		"HOST": ""
	},
	"WULIAN_OEM_ID_LENGTH": 12
})

;
(function (ng, _) {
  'use strict';

  var
    underscoreModule = ng.module('angular-underscore', []),
    utilsModule = ng.module('angular-underscore/utils', []),
    filtersModule = ng.module('angular-underscore/filters', []);

  // begin custom _

  function propGetterFactory(prop) {
    return function(obj) {return obj[prop];};
  }

  _._ = _;

  // Shiv "min", "max" ,"sortedIndex" to accept property predicate.
  _.each(['min', 'max', 'sortedIndex'], function(fnName) {
    _[fnName] = _.wrap(_[fnName], function(fn) {
      var args = _.toArray(arguments).slice(1);

      if(_.isString(args[2])) {
        // for "sortedIndex", transmuting str to property getter
        args[2] = propGetterFactory(args[2]);
      }
      else if(_.isString(args[1])) {
        // for "min" or "max", transmuting str to property getter
        args[1] = propGetterFactory(args[1]);
      }

      return fn.apply(_, args);
    });
  });

  // Shiv "filter", "reject" to angular's built-in,
  // and reserve underscore's feature(works on obj).
  ng.injector(['ng']).invoke(['$filter', function($filter) {
    _.filter = _.select = _.wrap($filter('filter'), function(filter, obj, exp, comparator) {
      if(!(_.isArray(obj))) {
        obj = _.toArray(obj);
      }

      return filter(obj, exp, comparator);
    });

    _.reject = function(obj, exp) {
      // use angular built-in negated predicate
      if(_.isString(exp)) {
        return _.filter(obj, '!' + exp);
      }

      var diff = _.bind(_.difference, _, obj);

      return diff(_.filter(obj, exp));
    };
  }]);

  // end custom _


  // begin register angular-underscore/utils

  _.each(_.methods(_), function(methodName) {
    function register($rootScope) {$rootScope[methodName] = _.bind(_[methodName], _);}

    _.each([
      underscoreModule,
      utilsModule,
      ng.module('angular-underscore/utils/' + methodName, [])
      ], function(module) {
        module.run(['$rootScope', register]);
    });
  });

  // end register angular-underscore/utils


  // begin register angular-underscore/filters

  var
    adapList = [
      ['map', 'collect'],
      ['reduce', 'inject', 'foldl'],
      ['reduceRight', 'foldr'],
      ['find', 'detect'],
      ['filter', 'select'],
      'where',
      'findWhere',
      'reject',
      'invoke',
      'pluck',
      'max',
      'min',
      'sortBy',
      'groupBy',
      'indexBy',
      'countBy',
      'shuffle',
      'sample',
      'toArray',
      'size',
      ['first', 'head', 'take'],
      'initial',
      'last',
      ['rest', 'tail', 'drop'],
      'compact',
      'flatten',
      'without',
      'partition',
      'union',
      'intersection',
      'difference',
      ['uniq', 'unique'],
      'zip',
      'object',
      'indexOf',
      'lastIndexOf',
      'sortedIndex',
      'keys',
      'values',
      'pairs',
      'invert',
      ['functions', 'methods'],
      'pick',
      'omit',
      'tap',
      'identity',
      'uniqueId',
      'escape',
      'unescape',
      'result',
      'template'
    ];

  _.each(adapList, function(filterNames) {
    if(!(_.isArray(filterNames))) {
      filterNames = [filterNames];
    }

    var
      filter = _.bind(_[filterNames[0]], _),
      filterFactory = function() {return filter;};

    _.each(filterNames, function(filterName) {
      _.each([
        underscoreModule,
        filtersModule,
        ng.module('angular-underscore/filters/' + filterName, [])
        ], function(module) {
          module.filter(filterName, filterFactory);
      });
    });
  });

  // end register angular-underscore/filters

}(angular, _));

(function(angular) {
  'use strict';
  angular.module('app', [
    'app.config',
    'ngCookies',
    'ui.bootstrap',
    'ui.router',
    'ngSanitize',
    'ngResource',
    'ngAnimate',
    'ngMessages',
    'ngMap',
    'angular-loading-bar',
    'ngTouch',
    'angular-carousel',
    'ngMaterial',
    'duScroll',
    'angular-underscore',
  ])
    .value('duScrollDuration', 1000)
    .value('duScrollOffset', 100)
    .value('duScrollActiveClass', 'active-slide')
    // .value('duScrollEasing', invertedEasingFunction)
    .config(configure)
    .run(runBlock);

  configure.$inject = ['$urlRouterProvider', '$locationProvider', '$httpProvider'];

  function configure($urlRouterProvider, $locationProvider, $httpProvider) {
    $httpProvider.defaults.withCredentials = true;
    $locationProvider.html5Mode({enabled: true, requireBase: false});
    $urlRouterProvider.otherwise('/404');
  }

  runBlock.$inject = ['$rootScope','$state'];

  function runBlock($rootScope, $state) {
    // $rootScope.$on('close-modals', function () {
    //   $uibModalStack.dismissAll();
    // });
    $rootScope.canonical = '/';
    $rootScope.$state = $state;
    $rootScope.$on('$stateChangeError', function(error) {
      console.log(error);
    });
    $rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState) {
      $rootScope.pageTitle = toState.data && toState.data.title ? toState.data.title : 'test task';
      angular.element('body').scrollTop(0);
    });
    $rootScope.broadcastScrollEvent = function () {
      $rootScope.$broadcast('scroll');
    };
  }
})(angular);

(function (angular) {
  "use strict";
  angular.module('app').factory('HomeService', HomeService);

  HomeService.$inject = [];

  function HomeService() {

    var news = [
        {
          title: 'Partnership for future without lie',
          titleFoto:'/img/news/news3-title.jpg',
          description: "Award-winning investigative journalist Diane Francis with Kira Rudik, Verified, Management and Operations, united their common forces to develop a project...",
          detailedDescription: {
            paragraph1: "Award-winning investigative journalist Diane Francis with Kira Rudik, Verified, Management and Operations, united their common forces to develop a project aimed to help people to find true statements in our fast-changing information society.",
            paragraph2: "It will be a real-time fact checking tool verifying statement and then receiving a rating about the accuracy of this ‘fact.’ Fact checking enables us to sort through a tidal wave of massive information and communication."
          },
          day: '',
          month: 'June',
          year: '2017',
          image: '/img/news/news3.jpg'
        },
        {
          title: 'Vsevolod Dyomkin about Verified Prototype',
          titleFoto:'/img/news/news2-title.jpg',
          description: "Verified is a prototype of the program that can determine whether the news is true or fake. The program checks the text for inconsistencies. The question is...",
          detailedDescription: {
            paragraph1: "Verified is a prototype of the program that can determine whether the news is true or fake. The program checks the text for inconsistencies. The question is “How the program works?”. There is a special field to enter the text: claims or quotes. After entering, the prototype compares it with other web sources.",
            paragraph2: "The program analyses data and finds confirmation or refutation. As the result, we get information that can confirm or refute this claim. If the result was not found, the claim is not confirmed. Verified goal is to help our society to identify the fake news and find the truth."
          },
          day: '',
          month: 'May',
          year: '2017',
          image: '/img/news/news2.jpg'
        },
        {
          title: 'The meet-up “Features and models of NLP"',
          titleFoto:'/img/news/news1-title.jpg',
          description: "The meet-up 'What features and models do work in NLP and why' was held on February, 10 by Vsevolod Dyomkin, Lisp Engineer, independent developer and expert in NLP.",
          detailedDescription: {
            paragraph1: "The meet-up 'What features and models do work in NLP and why' was held on February, 10 by Vsevolod Dyomkin, Lisp Engineer, independent developer and expert in NLP.",
            paragraph2: "Vsevolod spoke about linear models, random forest, RNN, morphological features, 1-hot encoding and word-embeddings. Meet-up was intended on audience with good experience in ML, who wanted to learn new information."
          },
          day: '10',
          month: 'February',
          year: '2017',
          image: '/img/news/news1.jpg'
        }
      ];

  return {
    news: news
  };
}
})
(angular);

(function (angular) {
  "use strict";
  angular.module('app').factory('TeamService', TeamService);

  TeamService.$inject = [];

  function TeamService() {

    var directors = [
      { name: 'Diane Francis',
        position:'Author, Professional Corporate Director, Professor, Entrepreneur, expert on Silicon Valley, future technology',
        image: 'fransis.jpg'
      },
      { name: 'Jason Mitura',
        position:'Serial Venture Capitalist, Viewdle',
        image: 'jason.jpg'
      },
      { name: 'Kira	Rudik',
        position:'Management and Operations',
        image: 'kira.jpg'
      },
      { name: 'Vsevolod Dyomkin',
        position:'World-Class researcher, Kyiv Polytechnic lecturer, 5 years NLP with Grammarly',
        image: 'dyomkin.jpg'
      }
    ];
    var team = [
        {name: 'Taras', position:'Researcher', image: 'taras-sereda-0006.jpg'},
        {name: 'Aleksandr', position:'Full Stack Developer', image: 'alex-lapshyn.jpg'}
      ];

    return {
      team: team,
      directors: directors
    };
  }
})(angular);

(function (angular) {
  "use strict";
  angular.module('app').factory('WindowEventsService', WindowEventsService);

  WindowEventsService.$inject = ['$window'];

  function WindowEventsService($window) {
    var api = {
      throttleTime: 100,
      listen: listen
    };

    //listener updates
    function listen(isOn, type, method, time) {

      //clean time, determine listener type
      var debounceTime = isNaN(time) ? api.throttleTime : time,
        listenerType = isOn ? 'addEventListener' : 'removeEventListener';

      //update throttled listener
      $window[listenerType](type, _.throttle(method, debounceTime));
    }

    //interface
    return api;
  }
})(angular);
angular.module('app').directive('onScroll', ["$timeout", function($timeout) {
  'use strict';

  return {
    scope: {
      onScroll: '&onScroll',
    },
    link: function(scope, element) {
      var scrollDelay = 250,
        scrollThrottleTimeout,
        throttled = false,
        scrollHandler = function() {
          if (!throttled) {
            scope.onScroll();
            throttled = true;
            scrollThrottleTimeout = $timeout(function(){
              throttled = false;
            }, scrollDelay);
          }
        };

      element.on("scroll", scrollHandler);

      scope.$on('$destroy', function() {
        element.off('scroll', scrollHandler);
      });
    }
  };
}]);

(function(angular) {
  'use strict';
  angular.module('app').controller('LandingController', LandingController);

  LandingController.$inject = ['$http', 'limitToFilter'];
  function LandingController($http, limitToFilter) {
    var main = this;

    main.formSubmit = formSubmit;
    main.error = 'something wrong';
    main.formData = {};
    main.showStep2 = false;
    main.showStep3 = false;

    main.minYears = 7671;
    main.dif70yers = 25569;
    main.todayDate = new Date();
    main.todayDays =  main.todayDate.getTime() / 86400000;
    main.ageCheck = ageCheck;
    main.ageInvalid = false;

    main.getCities = getCities;

    function ageCheck() {
      main.innStr = main.formData.inn.toString().substring(0, 5);
      main.ageCheckRes = main.todayDays + main.dif70yers - main.innStr;
      if (main.ageCheckRes >  main.minYears) {
        main.ageInvalid = false;
        return true;
      }   else {
        main.ageInvalid = true;
        return false;
      }
    }

    function formSubmit() {
      $http({
          url: '/',
          method: "POST",
          data: main.formData,
          headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;'}
          }).then(function successCallback(response) {
              alert('data sent');
          }, function errorCallback() {
              alert("something wrong");
            });
    }

    function getCities() {
      $http.get("http://gd.geobytes.com/AutoCompleteCity?callback=?&q=" + main.formData.city).then(function (response) {
        main.cities = limitToFilter(response.data, 15);
      });
    }
  }

})(angular);

(function(angular) {
  'use strict';
  angular.module('app').config(landingRoute);
  landingRoute.$inject = ['$stateProvider'];

  function landingRoute($stateProvider) {
    $stateProvider.state('landing', {
      abstract: true,
      templateUrl: '/view/modules/landing/landing.html',
      controller: 'LandingController',
      controllerAs: 'main'

    });
  }
})(angular);

(function (angular) {
  'use strict';
  angular.module('app').controller('LandingHomeController', LandingHomeController);


  LandingHomeController.$inject = ['$document', '$scope', '$window', 'WindowEventsService',
    'HomeService', '$stateParams', '$timeout', 'TeamService'];
  function LandingHomeController($document, $scope, $window, WindowEventsService,
                                 HomeService, $stateParams, $timeout, TeamService) {
    var vm = this;

    vm.scrollTo = scrollTo;


    function scrollTo(elementIndex) {
      $timeout(function () {
        $document.scrollToElementAnimated(vm.sections[elementIndex].element, 0);
      }, 100);
    }

    function getElementsHeight() {
      vm.eventsGridHeight = angular.element(document.getElementById('events-grid'))[0].clientHeight;
    }

  }

})(angular);

(function(angular) {
  'use strict';
  angular.module('app').config(landingHomeRoute);
  landingHomeRoute.$inject = ['$stateProvider'];

  function landingHomeRoute($stateProvider) {
    $stateProvider.state('landing.home', {
      url: '/',
      templateUrl: '/view/modules/landing/home/home.html',
      controller: 'LandingHomeController',
      controllerAs: 'vm',
      data: {
        title: 'test task'
      },
      params: {
        targetSectionName: 'main'
      }
    });
  }
})(angular);

(function(angular) {
  'use strict';
  angular.module('app').controller('LandingPage2Controller', LandingPage2Controller);

  LandingPage2Controller.$inject = ['$document', 'WindowEventsService', '$window', '$scope', '$timeout',
  'HomeService', '$stateParams'];
  function LandingPage2Controller($document, WindowEventsService, $window, $scope, $timeout,
     HomeService, $stateParams) {
    var vm = this;

    vm.scrollY = 0;
    vm.menuIsOpen = false;
    vm.toggleMobileMenu = toggleMobileMenu;
    vm.scrollTo = scrollTo;
    vm.windowWidth = $window.innerWidth;
    vm.windowHeight = $window.innerHeight;
    vm.windowY = 0;
    vm.news = HomeService.news;
    vm.newsLeftOut = vm.windowWidth * 0.29;
    vm.newsItemWidth = 400;
    vm.newsListWidth = vm.news.length * vm.newsItemWidth;
    vm.newsLeft = newsLeft;
    vm.newsRight = newsRight;
    vm.openNews = {};
    vm.detailedNewsOpened = false;
    vm.newsDetalsToggle = newsDetalsToggle;
    vm.leftArrowHovered = false;
    vm.rightArrowHovered = false;

    WindowEventsService.listen(true, 'scroll', defineScrollY);

    function defineScrollY() {
      vm.scrollY = $window.scrollY;
      $scope.$apply();
    }

    function scrollTo(sectionName) {
      $document.scrollToElementAnimated(vm.sections[sectionName].element);
    }

    function toggleMobileMenu() {
      vm.menuIsOpen = !vm.menuIsOpen;
    }


    if (vm.windowWidth < 700) {
      vm.newsLeftOut = 2;
      vm.newsItemWidth = 330;
    }

    function checkWindowWidth(){
        vm.windowWidth = $window.innerWidth;
        $timeout( checkWindowWidth, 200 );
    }
    checkWindowWidth();

    function eventDetails(event) {
      vm.selectedEvent = event;
      vm.showEventDetails = true;
    }

    function newsLeft() {
      if (vm.windowWidth > 700) {
        if(  (vm.newsListWidth + vm.newsLeftOut) < (vm.newsItemWidth * 2.5)  ) {
          vm.newsLeftOut = vm.windowWidth * 0.29;
        } else {
          vm.newsLeftOut -= vm.newsItemWidth;
        }
      } else {
        if(  (vm.newsListWidth + vm.newsLeftOut) < (vm.newsItemWidth*2.5)  ) {
          vm.newsLeftOut = 2;
        } else {
          vm.newsLeftOut -= vm.newsItemWidth;
        }
      }
    }

    function newsRight() {
      if (vm.windowWidth > 700) {
        if(  (vm.newsLeftOut/vm.windowWidth) > 0.73  ) {
          vm.newsLeftOut = vm.windowWidth * 0.29;
        } else {
          vm.newsLeftOut += vm.newsItemWidth;
        }
      } else {
        if(  vm.newsLeftOut < 3 && vm.newsLeftOut > -100  ) {
          vm.newsLeftOut = - vm.newsItemWidth * (vm.news.length - 1);
        } else {
          vm.newsLeftOut += vm.newsItemWidth;
        }
      }
    }

    function newsDetalsToggle() {
       vm.detailedNewsOpened = !vm.detailedNewsOpened;
    }

  }
})(angular);

(function(angular) {
  'use strict';
  angular.module('app').config(landingPage2Route);
  landingPage2Route.$inject = ['$stateProvider'];

  function landingPage2Route($stateProvider) {
    $stateProvider.state('landing.page2', {
      url: '/page2',
      templateUrl: '/view/modules/landing/page2/page2.html',
      controller: 'LandingPage2Controller',
      controllerAs: 'vm',
      data: {
        title: 'page 2'
      }
    });
  }
})(angular);

(function(angular) {
  'use strict';
  angular.module('app').controller('LandingPage3Controller', LandingPage3Controller);

  LandingPage3Controller.$inject = ['$document', 'WindowEventsService', '$window', '$scope', '$timeout',
  'TeamService', '$stateParams'];
  function LandingPage3Controller($document, WindowEventsService, $window, $scope, $timeout,
     TeamService, $stateParams) {
    var vm = this;

    vm.scrollY = 0;
    vm.menuIsOpen = false;
    vm.toggleMobileMenu = toggleMobileMenu;
    vm.scrollTo = scrollTo;
    vm.windowWidth = $window.innerWidth;
    vm.windowHeight = $window.innerHeight;
    vm.windowY = 0;
    vm.directors = TeamService.directors;
    vm.staff = TeamService.team;

    WindowEventsService.listen(true, 'scroll', defineScrollY);

    function defineScrollY() {
      vm.scrollY = $window.scrollY;
      $scope.$apply();
    }

    function scrollTo(sectionName) {
      $document.scrollToElementAnimated(vm.sections[sectionName].element);
    }

    function toggleMobileMenu() {
      vm.menuIsOpen = !vm.menuIsOpen;
    }

  }
})(angular);

(function(angular) {
  'use strict';
  angular.module('app').config(landingPage3Route);
  landingPage3Route.$inject = ['$stateProvider'];

  function landingPage3Route($stateProvider) {
    $stateProvider.state('landing.page3', {
      url: '/page3',
      templateUrl: '/view/modules/landing/page3/page3.html',
      controller: 'LandingPage3Controller',
      controllerAs: 'vm',
      data: {
        title: 'page 3'
      }
    });
  }
})(angular);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvY2FsLmpzIiwiYW5ndWxhci11bmRlcnNjb3JlLmpzIiwibWFpbi5qcyIsInNlcnZpY2VzL2hvbWUuc2VydmljZS5qcyIsInNlcnZpY2VzL3RlYW0uc2VydmljZS5qcyIsInNlcnZpY2VzL3dpbmRvdy1ldmVudHMtc2VydmljZS5qcyIsImNvbXBvbmVudHMvZGlyZWN0aXZlcy9vbi1zY3JvbGwuanMiLCJtb2R1bGVzL2xhbmRpbmcvbGFuZGluZy5jdHJsLmpzIiwibW9kdWxlcy9sYW5kaW5nL2xhbmRpbmcucm91dGUuanMiLCJtb2R1bGVzL2xhbmRpbmcvaG9tZS9ob21lLmN0cmwuanMiLCJtb2R1bGVzL2xhbmRpbmcvaG9tZS9ob21lLnJvdXRlLmpzIiwibW9kdWxlcy9sYW5kaW5nL3BhZ2UyL3BhZ2UyLmN0cmwuanMiLCJtb2R1bGVzL2xhbmRpbmcvcGFnZTIvcGFnZTIucm91dGUuanMiLCJtb2R1bGVzL2xhbmRpbmcvcGFnZTMvcGFnZTMuY3RybC5qcyIsIm1vZHVsZXMvbGFuZGluZy9wYWdlMy9wYWdlMy5yb3V0ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxRQUFBLE9BQUEsY0FBQTs7Q0FFQSxTQUFBLGVBQUE7Q0FDQSxPQUFBO0NBQ0EsT0FBQTtFQUNBLFFBQUE7O0NBRUEsd0JBQUE7Ozs7QUNQQSxDQUFBLFVBQUEsSUFBQSxHQUFBO0VBQ0E7O0VBRUE7SUFDQSxtQkFBQSxHQUFBLE9BQUEsc0JBQUE7SUFDQSxjQUFBLEdBQUEsT0FBQSw0QkFBQTtJQUNBLGdCQUFBLEdBQUEsT0FBQSw4QkFBQTs7OztFQUlBLFNBQUEsa0JBQUEsTUFBQTtJQUNBLE9BQUEsU0FBQSxLQUFBLENBQUEsT0FBQSxJQUFBOzs7RUFHQSxFQUFBLElBQUE7OztFQUdBLEVBQUEsS0FBQSxDQUFBLE9BQUEsT0FBQSxnQkFBQSxTQUFBLFFBQUE7SUFDQSxFQUFBLFVBQUEsRUFBQSxLQUFBLEVBQUEsU0FBQSxTQUFBLElBQUE7TUFDQSxJQUFBLE9BQUEsRUFBQSxRQUFBLFdBQUEsTUFBQTs7TUFFQSxHQUFBLEVBQUEsU0FBQSxLQUFBLEtBQUE7O1FBRUEsS0FBQSxLQUFBLGtCQUFBLEtBQUE7O1dBRUEsR0FBQSxFQUFBLFNBQUEsS0FBQSxLQUFBOztRQUVBLEtBQUEsS0FBQSxrQkFBQSxLQUFBOzs7TUFHQSxPQUFBLEdBQUEsTUFBQSxHQUFBOzs7Ozs7RUFNQSxHQUFBLFNBQUEsQ0FBQSxPQUFBLE9BQUEsQ0FBQSxXQUFBLFNBQUEsU0FBQTtJQUNBLEVBQUEsU0FBQSxFQUFBLFNBQUEsRUFBQSxLQUFBLFFBQUEsV0FBQSxTQUFBLFFBQUEsS0FBQSxLQUFBLFlBQUE7TUFDQSxHQUFBLEVBQUEsRUFBQSxRQUFBLE9BQUE7UUFDQSxNQUFBLEVBQUEsUUFBQTs7O01BR0EsT0FBQSxPQUFBLEtBQUEsS0FBQTs7O0lBR0EsRUFBQSxTQUFBLFNBQUEsS0FBQSxLQUFBOztNQUVBLEdBQUEsRUFBQSxTQUFBLE1BQUE7UUFDQSxPQUFBLEVBQUEsT0FBQSxLQUFBLE1BQUE7OztNQUdBLElBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxZQUFBLEdBQUE7O01BRUEsT0FBQSxLQUFBLEVBQUEsT0FBQSxLQUFBOzs7Ozs7Ozs7RUFTQSxFQUFBLEtBQUEsRUFBQSxRQUFBLElBQUEsU0FBQSxZQUFBO0lBQ0EsU0FBQSxTQUFBLFlBQUEsQ0FBQSxXQUFBLGNBQUEsRUFBQSxLQUFBLEVBQUEsYUFBQTs7SUFFQSxFQUFBLEtBQUE7TUFDQTtNQUNBO01BQ0EsR0FBQSxPQUFBLDhCQUFBLFlBQUE7U0FDQSxTQUFBLFFBQUE7UUFDQSxPQUFBLElBQUEsQ0FBQSxjQUFBOzs7Ozs7Ozs7RUFTQTtJQUNBLFdBQUE7TUFDQSxDQUFBLE9BQUE7TUFDQSxDQUFBLFVBQUEsVUFBQTtNQUNBLENBQUEsZUFBQTtNQUNBLENBQUEsUUFBQTtNQUNBLENBQUEsVUFBQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBLENBQUEsU0FBQSxRQUFBO01BQ0E7TUFDQTtNQUNBLENBQUEsUUFBQSxRQUFBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQSxDQUFBLFFBQUE7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQSxDQUFBLGFBQUE7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7TUFDQTtNQUNBO01BQ0E7OztFQUdBLEVBQUEsS0FBQSxVQUFBLFNBQUEsYUFBQTtJQUNBLEdBQUEsRUFBQSxFQUFBLFFBQUEsZUFBQTtNQUNBLGNBQUEsQ0FBQTs7O0lBR0E7TUFDQSxTQUFBLEVBQUEsS0FBQSxFQUFBLFlBQUEsS0FBQTtNQUNBLGdCQUFBLFdBQUEsQ0FBQSxPQUFBOztJQUVBLEVBQUEsS0FBQSxhQUFBLFNBQUEsWUFBQTtNQUNBLEVBQUEsS0FBQTtRQUNBO1FBQ0E7UUFDQSxHQUFBLE9BQUEsZ0NBQUEsWUFBQTtXQUNBLFNBQUEsUUFBQTtVQUNBLE9BQUEsT0FBQSxZQUFBOzs7Ozs7O0VBT0EsU0FBQTs7QUM1SkEsQ0FBQSxTQUFBLFNBQUE7RUFDQTtFQUNBLFFBQUEsT0FBQSxPQUFBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBOztLQUVBLE1BQUEsb0JBQUE7S0FDQSxNQUFBLGtCQUFBO0tBQ0EsTUFBQSx1QkFBQTs7S0FFQSxPQUFBO0tBQ0EsSUFBQTs7RUFFQSxVQUFBLFVBQUEsQ0FBQSxzQkFBQSxxQkFBQTs7RUFFQSxTQUFBLFVBQUEsb0JBQUEsbUJBQUEsZUFBQTtJQUNBLGNBQUEsU0FBQSxrQkFBQTtJQUNBLGtCQUFBLFVBQUEsQ0FBQSxTQUFBLE1BQUEsYUFBQTtJQUNBLG1CQUFBLFVBQUE7OztFQUdBLFNBQUEsVUFBQSxDQUFBLGFBQUE7O0VBRUEsU0FBQSxTQUFBLFlBQUEsUUFBQTs7OztJQUlBLFdBQUEsWUFBQTtJQUNBLFdBQUEsU0FBQTtJQUNBLFdBQUEsSUFBQSxxQkFBQSxTQUFBLE9BQUE7TUFDQSxRQUFBLElBQUE7O0lBRUEsV0FBQSxJQUFBLHVCQUFBLFNBQUEsT0FBQSxTQUFBLFVBQUEsV0FBQTtNQUNBLFdBQUEsWUFBQSxRQUFBLFFBQUEsUUFBQSxLQUFBLFFBQUEsUUFBQSxLQUFBLFFBQUE7TUFDQSxRQUFBLFFBQUEsUUFBQSxVQUFBOztJQUVBLFdBQUEsdUJBQUEsWUFBQTtNQUNBLFdBQUEsV0FBQTs7O0dBR0E7O0FDckRBLENBQUEsVUFBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxRQUFBLGVBQUE7O0VBRUEsWUFBQSxVQUFBOztFQUVBLFNBQUEsY0FBQTs7SUFFQSxJQUFBLE9BQUE7UUFDQTtVQUNBLE9BQUE7VUFDQSxVQUFBO1VBQ0EsYUFBQTtVQUNBLHFCQUFBO1lBQ0EsWUFBQTtZQUNBLFlBQUE7O1VBRUEsS0FBQTtVQUNBLE9BQUE7VUFDQSxNQUFBO1VBQ0EsT0FBQTs7UUFFQTtVQUNBLE9BQUE7VUFDQSxVQUFBO1VBQ0EsYUFBQTtVQUNBLHFCQUFBO1lBQ0EsWUFBQTtZQUNBLFlBQUE7O1VBRUEsS0FBQTtVQUNBLE9BQUE7VUFDQSxNQUFBO1VBQ0EsT0FBQTs7UUFFQTtVQUNBLE9BQUE7VUFDQSxVQUFBO1VBQ0EsYUFBQTtVQUNBLHFCQUFBO1lBQ0EsWUFBQTtZQUNBLFlBQUE7O1VBRUEsS0FBQTtVQUNBLE9BQUE7VUFDQSxNQUFBO1VBQ0EsT0FBQTs7OztFQUlBLE9BQUE7SUFDQSxNQUFBOzs7O0NBSUE7O0FDdkRBLENBQUEsVUFBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxRQUFBLGVBQUE7O0VBRUEsWUFBQSxVQUFBOztFQUVBLFNBQUEsY0FBQTs7SUFFQSxJQUFBLFlBQUE7TUFDQSxFQUFBLE1BQUE7UUFDQSxTQUFBO1FBQ0EsT0FBQTs7TUFFQSxFQUFBLE1BQUE7UUFDQSxTQUFBO1FBQ0EsT0FBQTs7TUFFQSxFQUFBLE1BQUE7UUFDQSxTQUFBO1FBQ0EsT0FBQTs7TUFFQSxFQUFBLE1BQUE7UUFDQSxTQUFBO1FBQ0EsT0FBQTs7O0lBR0EsSUFBQSxPQUFBO1FBQ0EsQ0FBQSxNQUFBLFNBQUEsU0FBQSxjQUFBLE9BQUE7UUFDQSxDQUFBLE1BQUEsYUFBQSxTQUFBLHdCQUFBLE9BQUE7OztJQUdBLE9BQUE7TUFDQSxNQUFBO01BQ0EsV0FBQTs7O0dBR0E7O0FDcENBLENBQUEsVUFBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxRQUFBLHVCQUFBOztFQUVBLG9CQUFBLFVBQUEsQ0FBQTs7RUFFQSxTQUFBLG9CQUFBLFNBQUE7SUFDQSxJQUFBLE1BQUE7TUFDQSxjQUFBO01BQ0EsUUFBQTs7OztJQUlBLFNBQUEsT0FBQSxNQUFBLE1BQUEsUUFBQSxNQUFBOzs7TUFHQSxJQUFBLGVBQUEsTUFBQSxRQUFBLElBQUEsZUFBQTtRQUNBLGVBQUEsT0FBQSxxQkFBQTs7O01BR0EsUUFBQSxjQUFBLE1BQUEsRUFBQSxTQUFBLFFBQUE7Ozs7SUFJQSxPQUFBOztHQUVBO0FDMUJBLFFBQUEsT0FBQSxPQUFBLFVBQUEseUJBQUEsU0FBQSxVQUFBO0VBQ0E7O0VBRUEsT0FBQTtJQUNBLE9BQUE7TUFDQSxVQUFBOztJQUVBLE1BQUEsU0FBQSxPQUFBLFNBQUE7TUFDQSxJQUFBLGNBQUE7UUFDQTtRQUNBLFlBQUE7UUFDQSxnQkFBQSxXQUFBO1VBQ0EsSUFBQSxDQUFBLFdBQUE7WUFDQSxNQUFBO1lBQ0EsWUFBQTtZQUNBLHdCQUFBLFNBQUEsVUFBQTtjQUNBLFlBQUE7ZUFDQTs7OztNQUlBLFFBQUEsR0FBQSxVQUFBOztNQUVBLE1BQUEsSUFBQSxZQUFBLFdBQUE7UUFDQSxRQUFBLElBQUEsVUFBQTs7Ozs7O0FDeEJBLENBQUEsU0FBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxXQUFBLHFCQUFBOztFQUVBLGtCQUFBLFVBQUEsQ0FBQSxTQUFBO0VBQ0EsU0FBQSxrQkFBQSxPQUFBLGVBQUE7SUFDQSxJQUFBLE9BQUE7O0lBRUEsS0FBQSxhQUFBO0lBQ0EsS0FBQSxRQUFBO0lBQ0EsS0FBQSxXQUFBO0lBQ0EsS0FBQSxZQUFBO0lBQ0EsS0FBQSxZQUFBOztJQUVBLEtBQUEsV0FBQTtJQUNBLEtBQUEsWUFBQTtJQUNBLEtBQUEsWUFBQSxJQUFBO0lBQ0EsS0FBQSxhQUFBLEtBQUEsVUFBQSxZQUFBO0lBQ0EsS0FBQSxXQUFBO0lBQ0EsS0FBQSxhQUFBOztJQUVBLEtBQUEsWUFBQTs7SUFFQSxTQUFBLFdBQUE7TUFDQSxLQUFBLFNBQUEsS0FBQSxTQUFBLElBQUEsV0FBQSxVQUFBLEdBQUE7TUFDQSxLQUFBLGNBQUEsS0FBQSxZQUFBLEtBQUEsWUFBQSxLQUFBO01BQ0EsSUFBQSxLQUFBLGVBQUEsS0FBQSxVQUFBO1FBQ0EsS0FBQSxhQUFBO1FBQ0EsT0FBQTtlQUNBO1FBQ0EsS0FBQSxhQUFBO1FBQ0EsT0FBQTs7OztJQUlBLFNBQUEsYUFBQTtNQUNBLE1BQUE7VUFDQSxLQUFBO1VBQ0EsUUFBQTtVQUNBLE1BQUEsS0FBQTtVQUNBLFNBQUEsQ0FBQSxnQkFBQTthQUNBLEtBQUEsU0FBQSxnQkFBQSxVQUFBO2NBQ0EsTUFBQTthQUNBLFNBQUEsZ0JBQUE7Y0FDQSxNQUFBOzs7O0lBSUEsU0FBQSxZQUFBO01BQ0EsTUFBQSxJQUFBLDBEQUFBLEtBQUEsU0FBQSxNQUFBLEtBQUEsVUFBQSxVQUFBO1FBQ0EsS0FBQSxTQUFBLGNBQUEsU0FBQSxNQUFBOzs7OztHQUtBOztBQ3ZEQSxDQUFBLFNBQUEsU0FBQTtFQUNBO0VBQ0EsUUFBQSxPQUFBLE9BQUEsT0FBQTtFQUNBLGFBQUEsVUFBQSxDQUFBOztFQUVBLFNBQUEsYUFBQSxnQkFBQTtJQUNBLGVBQUEsTUFBQSxXQUFBO01BQ0EsVUFBQTtNQUNBLGFBQUE7TUFDQSxZQUFBO01BQ0EsY0FBQTs7OztHQUlBOztBQ2RBLENBQUEsVUFBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxXQUFBLHlCQUFBOzs7RUFHQSxzQkFBQSxVQUFBLENBQUEsYUFBQSxVQUFBLFdBQUE7SUFDQSxlQUFBLGdCQUFBLFlBQUE7RUFDQSxTQUFBLHNCQUFBLFdBQUEsUUFBQSxTQUFBO2lDQUNBLGFBQUEsY0FBQSxVQUFBLGFBQUE7SUFDQSxJQUFBLEtBQUE7O0lBRUEsR0FBQSxXQUFBOzs7SUFHQSxTQUFBLFNBQUEsY0FBQTtNQUNBLFNBQUEsWUFBQTtRQUNBLFVBQUEsd0JBQUEsR0FBQSxTQUFBLGNBQUEsU0FBQTtTQUNBOzs7SUFHQSxTQUFBLG9CQUFBO01BQ0EsR0FBQSxtQkFBQSxRQUFBLFFBQUEsU0FBQSxlQUFBLGdCQUFBLEdBQUE7Ozs7O0dBS0E7O0FDMUJBLENBQUEsU0FBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxPQUFBO0VBQ0EsaUJBQUEsVUFBQSxDQUFBOztFQUVBLFNBQUEsaUJBQUEsZ0JBQUE7SUFDQSxlQUFBLE1BQUEsZ0JBQUE7TUFDQSxLQUFBO01BQ0EsYUFBQTtNQUNBLFlBQUE7TUFDQSxjQUFBO01BQ0EsTUFBQTtRQUNBLE9BQUE7O01BRUEsUUFBQTtRQUNBLG1CQUFBOzs7O0dBSUE7O0FDbkJBLENBQUEsU0FBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxXQUFBLDBCQUFBOztFQUVBLHVCQUFBLFVBQUEsQ0FBQSxhQUFBLHVCQUFBLFdBQUEsVUFBQTtFQUNBLGVBQUE7RUFDQSxTQUFBLHVCQUFBLFdBQUEscUJBQUEsU0FBQSxRQUFBO0tBQ0EsYUFBQSxjQUFBO0lBQ0EsSUFBQSxLQUFBOztJQUVBLEdBQUEsVUFBQTtJQUNBLEdBQUEsYUFBQTtJQUNBLEdBQUEsbUJBQUE7SUFDQSxHQUFBLFdBQUE7SUFDQSxHQUFBLGNBQUEsUUFBQTtJQUNBLEdBQUEsZUFBQSxRQUFBO0lBQ0EsR0FBQSxVQUFBO0lBQ0EsR0FBQSxPQUFBLFlBQUE7SUFDQSxHQUFBLGNBQUEsR0FBQSxjQUFBO0lBQ0EsR0FBQSxnQkFBQTtJQUNBLEdBQUEsZ0JBQUEsR0FBQSxLQUFBLFNBQUEsR0FBQTtJQUNBLEdBQUEsV0FBQTtJQUNBLEdBQUEsWUFBQTtJQUNBLEdBQUEsV0FBQTtJQUNBLEdBQUEscUJBQUE7SUFDQSxHQUFBLG1CQUFBO0lBQ0EsR0FBQSxtQkFBQTtJQUNBLEdBQUEsb0JBQUE7O0lBRUEsb0JBQUEsT0FBQSxNQUFBLFVBQUE7O0lBRUEsU0FBQSxnQkFBQTtNQUNBLEdBQUEsVUFBQSxRQUFBO01BQ0EsT0FBQTs7O0lBR0EsU0FBQSxTQUFBLGFBQUE7TUFDQSxVQUFBLHdCQUFBLEdBQUEsU0FBQSxhQUFBOzs7SUFHQSxTQUFBLG1CQUFBO01BQ0EsR0FBQSxhQUFBLENBQUEsR0FBQTs7OztJQUlBLElBQUEsR0FBQSxjQUFBLEtBQUE7TUFDQSxHQUFBLGNBQUE7TUFDQSxHQUFBLGdCQUFBOzs7SUFHQSxTQUFBLGtCQUFBO1FBQ0EsR0FBQSxjQUFBLFFBQUE7UUFDQSxVQUFBLGtCQUFBOztJQUVBOztJQUVBLFNBQUEsYUFBQSxPQUFBO01BQ0EsR0FBQSxnQkFBQTtNQUNBLEdBQUEsbUJBQUE7OztJQUdBLFNBQUEsV0FBQTtNQUNBLElBQUEsR0FBQSxjQUFBLEtBQUE7UUFDQSxLQUFBLENBQUEsR0FBQSxnQkFBQSxHQUFBLGdCQUFBLEdBQUEsZ0JBQUEsUUFBQTtVQUNBLEdBQUEsY0FBQSxHQUFBLGNBQUE7ZUFDQTtVQUNBLEdBQUEsZUFBQSxHQUFBOzthQUVBO1FBQ0EsS0FBQSxDQUFBLEdBQUEsZ0JBQUEsR0FBQSxnQkFBQSxHQUFBLGNBQUEsUUFBQTtVQUNBLEdBQUEsY0FBQTtlQUNBO1VBQ0EsR0FBQSxlQUFBLEdBQUE7Ozs7O0lBS0EsU0FBQSxZQUFBO01BQ0EsSUFBQSxHQUFBLGNBQUEsS0FBQTtRQUNBLEtBQUEsQ0FBQSxHQUFBLFlBQUEsR0FBQSxlQUFBLFFBQUE7VUFDQSxHQUFBLGNBQUEsR0FBQSxjQUFBO2VBQ0E7VUFDQSxHQUFBLGVBQUEsR0FBQTs7YUFFQTtRQUNBLEtBQUEsR0FBQSxjQUFBLEtBQUEsR0FBQSxjQUFBLENBQUEsT0FBQTtVQUNBLEdBQUEsY0FBQSxFQUFBLEdBQUEsaUJBQUEsR0FBQSxLQUFBLFNBQUE7ZUFDQTtVQUNBLEdBQUEsZUFBQSxHQUFBOzs7OztJQUtBLFNBQUEsbUJBQUE7T0FDQSxHQUFBLHFCQUFBLENBQUEsR0FBQTs7OztHQUlBOztBQ2xHQSxDQUFBLFNBQUEsU0FBQTtFQUNBO0VBQ0EsUUFBQSxPQUFBLE9BQUEsT0FBQTtFQUNBLGtCQUFBLFVBQUEsQ0FBQTs7RUFFQSxTQUFBLGtCQUFBLGdCQUFBO0lBQ0EsZUFBQSxNQUFBLGlCQUFBO01BQ0EsS0FBQTtNQUNBLGFBQUE7TUFDQSxZQUFBO01BQ0EsY0FBQTtNQUNBLE1BQUE7UUFDQSxPQUFBOzs7O0dBSUE7O0FDaEJBLENBQUEsU0FBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxXQUFBLDBCQUFBOztFQUVBLHVCQUFBLFVBQUEsQ0FBQSxhQUFBLHVCQUFBLFdBQUEsVUFBQTtFQUNBLGVBQUE7RUFDQSxTQUFBLHVCQUFBLFdBQUEscUJBQUEsU0FBQSxRQUFBO0tBQ0EsYUFBQSxjQUFBO0lBQ0EsSUFBQSxLQUFBOztJQUVBLEdBQUEsVUFBQTtJQUNBLEdBQUEsYUFBQTtJQUNBLEdBQUEsbUJBQUE7SUFDQSxHQUFBLFdBQUE7SUFDQSxHQUFBLGNBQUEsUUFBQTtJQUNBLEdBQUEsZUFBQSxRQUFBO0lBQ0EsR0FBQSxVQUFBO0lBQ0EsR0FBQSxZQUFBLFlBQUE7SUFDQSxHQUFBLFFBQUEsWUFBQTs7SUFFQSxvQkFBQSxPQUFBLE1BQUEsVUFBQTs7SUFFQSxTQUFBLGdCQUFBO01BQ0EsR0FBQSxVQUFBLFFBQUE7TUFDQSxPQUFBOzs7SUFHQSxTQUFBLFNBQUEsYUFBQTtNQUNBLFVBQUEsd0JBQUEsR0FBQSxTQUFBLGFBQUE7OztJQUdBLFNBQUEsbUJBQUE7TUFDQSxHQUFBLGFBQUEsQ0FBQSxHQUFBOzs7O0dBSUE7O0FDcENBLENBQUEsU0FBQSxTQUFBO0VBQ0E7RUFDQSxRQUFBLE9BQUEsT0FBQSxPQUFBO0VBQ0Esa0JBQUEsVUFBQSxDQUFBOztFQUVBLFNBQUEsa0JBQUEsZ0JBQUE7SUFDQSxlQUFBLE1BQUEsaUJBQUE7TUFDQSxLQUFBO01BQ0EsYUFBQTtNQUNBLFlBQUE7TUFDQSxjQUFBO01BQ0EsTUFBQTtRQUNBLE9BQUE7Ozs7R0FJQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZShcImFwcC5jb25maWdcIiwgW10pXG5cbi5jb25zdGFudChcImFwcFNldHRpbmdzXCIsIHtcblx0XCJERVZcIjogdHJ1ZSxcblx0XCJBUElcIjoge1xuXHRcdFwiSE9TVFwiOiBcIlwiXG5cdH0sXG5cdFwiV1VMSUFOX09FTV9JRF9MRU5HVEhcIjogMTJcbn0pXG5cbjsiLCIoZnVuY3Rpb24gKG5nLCBfKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICB2YXJcclxuICAgIHVuZGVyc2NvcmVNb2R1bGUgPSBuZy5tb2R1bGUoJ2FuZ3VsYXItdW5kZXJzY29yZScsIFtdKSxcclxuICAgIHV0aWxzTW9kdWxlID0gbmcubW9kdWxlKCdhbmd1bGFyLXVuZGVyc2NvcmUvdXRpbHMnLCBbXSksXHJcbiAgICBmaWx0ZXJzTW9kdWxlID0gbmcubW9kdWxlKCdhbmd1bGFyLXVuZGVyc2NvcmUvZmlsdGVycycsIFtdKTtcclxuXHJcbiAgLy8gYmVnaW4gY3VzdG9tIF9cclxuXHJcbiAgZnVuY3Rpb24gcHJvcEdldHRlckZhY3RvcnkocHJvcCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikge3JldHVybiBvYmpbcHJvcF07fTtcclxuICB9XHJcblxyXG4gIF8uXyA9IF87XHJcblxyXG4gIC8vIFNoaXYgXCJtaW5cIiwgXCJtYXhcIiAsXCJzb3J0ZWRJbmRleFwiIHRvIGFjY2VwdCBwcm9wZXJ0eSBwcmVkaWNhdGUuXHJcbiAgXy5lYWNoKFsnbWluJywgJ21heCcsICdzb3J0ZWRJbmRleCddLCBmdW5jdGlvbihmbk5hbWUpIHtcclxuICAgIF9bZm5OYW1lXSA9IF8ud3JhcChfW2ZuTmFtZV0sIGZ1bmN0aW9uKGZuKSB7XHJcbiAgICAgIHZhciBhcmdzID0gXy50b0FycmF5KGFyZ3VtZW50cykuc2xpY2UoMSk7XHJcblxyXG4gICAgICBpZihfLmlzU3RyaW5nKGFyZ3NbMl0pKSB7XHJcbiAgICAgICAgLy8gZm9yIFwic29ydGVkSW5kZXhcIiwgdHJhbnNtdXRpbmcgc3RyIHRvIHByb3BlcnR5IGdldHRlclxyXG4gICAgICAgIGFyZ3NbMl0gPSBwcm9wR2V0dGVyRmFjdG9yeShhcmdzWzJdKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIGlmKF8uaXNTdHJpbmcoYXJnc1sxXSkpIHtcclxuICAgICAgICAvLyBmb3IgXCJtaW5cIiBvciBcIm1heFwiLCB0cmFuc211dGluZyBzdHIgdG8gcHJvcGVydHkgZ2V0dGVyXHJcbiAgICAgICAgYXJnc1sxXSA9IHByb3BHZXR0ZXJGYWN0b3J5KGFyZ3NbMV0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gZm4uYXBwbHkoXywgYXJncyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgLy8gU2hpdiBcImZpbHRlclwiLCBcInJlamVjdFwiIHRvIGFuZ3VsYXIncyBidWlsdC1pbixcclxuICAvLyBhbmQgcmVzZXJ2ZSB1bmRlcnNjb3JlJ3MgZmVhdHVyZSh3b3JrcyBvbiBvYmopLlxyXG4gIG5nLmluamVjdG9yKFsnbmcnXSkuaW52b2tlKFsnJGZpbHRlcicsIGZ1bmN0aW9uKCRmaWx0ZXIpIHtcclxuICAgIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBfLndyYXAoJGZpbHRlcignZmlsdGVyJyksIGZ1bmN0aW9uKGZpbHRlciwgb2JqLCBleHAsIGNvbXBhcmF0b3IpIHtcclxuICAgICAgaWYoIShfLmlzQXJyYXkob2JqKSkpIHtcclxuICAgICAgICBvYmogPSBfLnRvQXJyYXkob2JqKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIGZpbHRlcihvYmosIGV4cCwgY29tcGFyYXRvcik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBfLnJlamVjdCA9IGZ1bmN0aW9uKG9iaiwgZXhwKSB7XHJcbiAgICAgIC8vIHVzZSBhbmd1bGFyIGJ1aWx0LWluIG5lZ2F0ZWQgcHJlZGljYXRlXHJcbiAgICAgIGlmKF8uaXNTdHJpbmcoZXhwKSkge1xyXG4gICAgICAgIHJldHVybiBfLmZpbHRlcihvYmosICchJyArIGV4cCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhciBkaWZmID0gXy5iaW5kKF8uZGlmZmVyZW5jZSwgXywgb2JqKTtcclxuXHJcbiAgICAgIHJldHVybiBkaWZmKF8uZmlsdGVyKG9iaiwgZXhwKSk7XHJcbiAgICB9O1xyXG4gIH1dKTtcclxuXHJcbiAgLy8gZW5kIGN1c3RvbSBfXHJcblxyXG5cclxuICAvLyBiZWdpbiByZWdpc3RlciBhbmd1bGFyLXVuZGVyc2NvcmUvdXRpbHNcclxuXHJcbiAgXy5lYWNoKF8ubWV0aG9kcyhfKSwgZnVuY3Rpb24obWV0aG9kTmFtZSkge1xyXG4gICAgZnVuY3Rpb24gcmVnaXN0ZXIoJHJvb3RTY29wZSkgeyRyb290U2NvcGVbbWV0aG9kTmFtZV0gPSBfLmJpbmQoX1ttZXRob2ROYW1lXSwgXyk7fVxyXG5cclxuICAgIF8uZWFjaChbXHJcbiAgICAgIHVuZGVyc2NvcmVNb2R1bGUsXHJcbiAgICAgIHV0aWxzTW9kdWxlLFxyXG4gICAgICBuZy5tb2R1bGUoJ2FuZ3VsYXItdW5kZXJzY29yZS91dGlscy8nICsgbWV0aG9kTmFtZSwgW10pXHJcbiAgICAgIF0sIGZ1bmN0aW9uKG1vZHVsZSkge1xyXG4gICAgICAgIG1vZHVsZS5ydW4oWyckcm9vdFNjb3BlJywgcmVnaXN0ZXJdKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyBlbmQgcmVnaXN0ZXIgYW5ndWxhci11bmRlcnNjb3JlL3V0aWxzXHJcblxyXG5cclxuICAvLyBiZWdpbiByZWdpc3RlciBhbmd1bGFyLXVuZGVyc2NvcmUvZmlsdGVyc1xyXG5cclxuICB2YXJcclxuICAgIGFkYXBMaXN0ID0gW1xyXG4gICAgICBbJ21hcCcsICdjb2xsZWN0J10sXHJcbiAgICAgIFsncmVkdWNlJywgJ2luamVjdCcsICdmb2xkbCddLFxyXG4gICAgICBbJ3JlZHVjZVJpZ2h0JywgJ2ZvbGRyJ10sXHJcbiAgICAgIFsnZmluZCcsICdkZXRlY3QnXSxcclxuICAgICAgWydmaWx0ZXInLCAnc2VsZWN0J10sXHJcbiAgICAgICd3aGVyZScsXHJcbiAgICAgICdmaW5kV2hlcmUnLFxyXG4gICAgICAncmVqZWN0JyxcclxuICAgICAgJ2ludm9rZScsXHJcbiAgICAgICdwbHVjaycsXHJcbiAgICAgICdtYXgnLFxyXG4gICAgICAnbWluJyxcclxuICAgICAgJ3NvcnRCeScsXHJcbiAgICAgICdncm91cEJ5JyxcclxuICAgICAgJ2luZGV4QnknLFxyXG4gICAgICAnY291bnRCeScsXHJcbiAgICAgICdzaHVmZmxlJyxcclxuICAgICAgJ3NhbXBsZScsXHJcbiAgICAgICd0b0FycmF5JyxcclxuICAgICAgJ3NpemUnLFxyXG4gICAgICBbJ2ZpcnN0JywgJ2hlYWQnLCAndGFrZSddLFxyXG4gICAgICAnaW5pdGlhbCcsXHJcbiAgICAgICdsYXN0JyxcclxuICAgICAgWydyZXN0JywgJ3RhaWwnLCAnZHJvcCddLFxyXG4gICAgICAnY29tcGFjdCcsXHJcbiAgICAgICdmbGF0dGVuJyxcclxuICAgICAgJ3dpdGhvdXQnLFxyXG4gICAgICAncGFydGl0aW9uJyxcclxuICAgICAgJ3VuaW9uJyxcclxuICAgICAgJ2ludGVyc2VjdGlvbicsXHJcbiAgICAgICdkaWZmZXJlbmNlJyxcclxuICAgICAgWyd1bmlxJywgJ3VuaXF1ZSddLFxyXG4gICAgICAnemlwJyxcclxuICAgICAgJ29iamVjdCcsXHJcbiAgICAgICdpbmRleE9mJyxcclxuICAgICAgJ2xhc3RJbmRleE9mJyxcclxuICAgICAgJ3NvcnRlZEluZGV4JyxcclxuICAgICAgJ2tleXMnLFxyXG4gICAgICAndmFsdWVzJyxcclxuICAgICAgJ3BhaXJzJyxcclxuICAgICAgJ2ludmVydCcsXHJcbiAgICAgIFsnZnVuY3Rpb25zJywgJ21ldGhvZHMnXSxcclxuICAgICAgJ3BpY2snLFxyXG4gICAgICAnb21pdCcsXHJcbiAgICAgICd0YXAnLFxyXG4gICAgICAnaWRlbnRpdHknLFxyXG4gICAgICAndW5pcXVlSWQnLFxyXG4gICAgICAnZXNjYXBlJyxcclxuICAgICAgJ3VuZXNjYXBlJyxcclxuICAgICAgJ3Jlc3VsdCcsXHJcbiAgICAgICd0ZW1wbGF0ZSdcclxuICAgIF07XHJcblxyXG4gIF8uZWFjaChhZGFwTGlzdCwgZnVuY3Rpb24oZmlsdGVyTmFtZXMpIHtcclxuICAgIGlmKCEoXy5pc0FycmF5KGZpbHRlck5hbWVzKSkpIHtcclxuICAgICAgZmlsdGVyTmFtZXMgPSBbZmlsdGVyTmFtZXNdO1xyXG4gICAgfVxyXG5cclxuICAgIHZhclxyXG4gICAgICBmaWx0ZXIgPSBfLmJpbmQoX1tmaWx0ZXJOYW1lc1swXV0sIF8pLFxyXG4gICAgICBmaWx0ZXJGYWN0b3J5ID0gZnVuY3Rpb24oKSB7cmV0dXJuIGZpbHRlcjt9O1xyXG5cclxuICAgIF8uZWFjaChmaWx0ZXJOYW1lcywgZnVuY3Rpb24oZmlsdGVyTmFtZSkge1xyXG4gICAgICBfLmVhY2goW1xyXG4gICAgICAgIHVuZGVyc2NvcmVNb2R1bGUsXHJcbiAgICAgICAgZmlsdGVyc01vZHVsZSxcclxuICAgICAgICBuZy5tb2R1bGUoJ2FuZ3VsYXItdW5kZXJzY29yZS9maWx0ZXJzLycgKyBmaWx0ZXJOYW1lLCBbXSlcclxuICAgICAgICBdLCBmdW5jdGlvbihtb2R1bGUpIHtcclxuICAgICAgICAgIG1vZHVsZS5maWx0ZXIoZmlsdGVyTmFtZSwgZmlsdGVyRmFjdG9yeSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIGVuZCByZWdpc3RlciBhbmd1bGFyLXVuZGVyc2NvcmUvZmlsdGVyc1xyXG5cclxufShhbmd1bGFyLCBfKSk7XHJcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXHJcbiAgICAnYXBwLmNvbmZpZycsXHJcbiAgICAnbmdDb29raWVzJyxcclxuICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnbmdTYW5pdGl6ZScsXHJcbiAgICAnbmdSZXNvdXJjZScsXHJcbiAgICAnbmdBbmltYXRlJyxcclxuICAgICduZ01lc3NhZ2VzJyxcclxuICAgICduZ01hcCcsXHJcbiAgICAnYW5ndWxhci1sb2FkaW5nLWJhcicsXHJcbiAgICAnbmdUb3VjaCcsXHJcbiAgICAnYW5ndWxhci1jYXJvdXNlbCcsXHJcbiAgICAnbmdNYXRlcmlhbCcsXHJcbiAgICAnZHVTY3JvbGwnLFxyXG4gICAgJ2FuZ3VsYXItdW5kZXJzY29yZScsXHJcbiAgXSlcclxuICAgIC52YWx1ZSgnZHVTY3JvbGxEdXJhdGlvbicsIDEwMDApXHJcbiAgICAudmFsdWUoJ2R1U2Nyb2xsT2Zmc2V0JywgMTAwKVxyXG4gICAgLnZhbHVlKCdkdVNjcm9sbEFjdGl2ZUNsYXNzJywgJ2FjdGl2ZS1zbGlkZScpXHJcbiAgICAvLyAudmFsdWUoJ2R1U2Nyb2xsRWFzaW5nJywgaW52ZXJ0ZWRFYXNpbmdGdW5jdGlvbilcclxuICAgIC5jb25maWcoY29uZmlndXJlKVxyXG4gICAgLnJ1bihydW5CbG9jayk7XHJcblxyXG4gIGNvbmZpZ3VyZS4kaW5qZWN0ID0gWyckdXJsUm91dGVyUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCAnJGh0dHBQcm92aWRlciddO1xyXG5cclxuICBmdW5jdGlvbiBjb25maWd1cmUoJHVybFJvdXRlclByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcikge1xyXG4gICAgJGh0dHBQcm92aWRlci5kZWZhdWx0cy53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xyXG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHtlbmFibGVkOiB0cnVlLCByZXF1aXJlQmFzZTogZmFsc2V9KTtcclxuICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy80MDQnKTtcclxuICB9XHJcblxyXG4gIHJ1bkJsb2NrLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCckc3RhdGUnXTtcclxuXHJcbiAgZnVuY3Rpb24gcnVuQmxvY2soJHJvb3RTY29wZSwgJHN0YXRlKSB7XHJcbiAgICAvLyAkcm9vdFNjb3BlLiRvbignY2xvc2UtbW9kYWxzJywgZnVuY3Rpb24gKCkge1xyXG4gICAgLy8gICAkdWliTW9kYWxTdGFjay5kaXNtaXNzQWxsKCk7XHJcbiAgICAvLyB9KTtcclxuICAgICRyb290U2NvcGUuY2Fub25pY2FsID0gJy8nO1xyXG4gICAgJHJvb3RTY29wZS4kc3RhdGUgPSAkc3RhdGU7XHJcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbihlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICB9KTtcclxuICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUpIHtcclxuICAgICAgJHJvb3RTY29wZS5wYWdlVGl0bGUgPSB0b1N0YXRlLmRhdGEgJiYgdG9TdGF0ZS5kYXRhLnRpdGxlID8gdG9TdGF0ZS5kYXRhLnRpdGxlIDogJ3Rlc3QgdGFzayc7XHJcbiAgICAgIGFuZ3VsYXIuZWxlbWVudCgnYm9keScpLnNjcm9sbFRvcCgwKTtcclxuICAgIH0pO1xyXG4gICAgJHJvb3RTY29wZS5icm9hZGNhc3RTY3JvbGxFdmVudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwnKTtcclxuICAgIH07XHJcbiAgfVxyXG59KShhbmd1bGFyKTtcclxuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ0hvbWVTZXJ2aWNlJywgSG9tZVNlcnZpY2UpO1xyXG5cclxuICBIb21lU2VydmljZS4kaW5qZWN0ID0gW107XHJcblxyXG4gIGZ1bmN0aW9uIEhvbWVTZXJ2aWNlKCkge1xyXG5cclxuICAgIHZhciBuZXdzID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRpdGxlOiAnUGFydG5lcnNoaXAgZm9yIGZ1dHVyZSB3aXRob3V0IGxpZScsXHJcbiAgICAgICAgICB0aXRsZUZvdG86Jy9pbWcvbmV3cy9uZXdzMy10aXRsZS5qcGcnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiQXdhcmQtd2lubmluZyBpbnZlc3RpZ2F0aXZlIGpvdXJuYWxpc3QgRGlhbmUgRnJhbmNpcyB3aXRoIEtpcmEgUnVkaWssIFZlcmlmaWVkLCBNYW5hZ2VtZW50IGFuZCBPcGVyYXRpb25zLCB1bml0ZWQgdGhlaXIgY29tbW9uIGZvcmNlcyB0byBkZXZlbG9wIGEgcHJvamVjdC4uLlwiLFxyXG4gICAgICAgICAgZGV0YWlsZWREZXNjcmlwdGlvbjoge1xyXG4gICAgICAgICAgICBwYXJhZ3JhcGgxOiBcIkF3YXJkLXdpbm5pbmcgaW52ZXN0aWdhdGl2ZSBqb3VybmFsaXN0IERpYW5lIEZyYW5jaXMgd2l0aCBLaXJhIFJ1ZGlrLCBWZXJpZmllZCwgTWFuYWdlbWVudCBhbmQgT3BlcmF0aW9ucywgdW5pdGVkIHRoZWlyIGNvbW1vbiBmb3JjZXMgdG8gZGV2ZWxvcCBhIHByb2plY3QgYWltZWQgdG8gaGVscCBwZW9wbGUgdG8gZmluZCB0cnVlIHN0YXRlbWVudHMgaW4gb3VyIGZhc3QtY2hhbmdpbmcgaW5mb3JtYXRpb24gc29jaWV0eS5cIixcclxuICAgICAgICAgICAgcGFyYWdyYXBoMjogXCJJdCB3aWxsIGJlIGEgcmVhbC10aW1lIGZhY3QgY2hlY2tpbmcgdG9vbCB2ZXJpZnlpbmcgc3RhdGVtZW50IGFuZCB0aGVuIHJlY2VpdmluZyBhIHJhdGluZyBhYm91dCB0aGUgYWNjdXJhY3kgb2YgdGhpcyDigJhmYWN0LuKAmSBGYWN0IGNoZWNraW5nIGVuYWJsZXMgdXMgdG8gc29ydCB0aHJvdWdoIGEgdGlkYWwgd2F2ZSBvZiBtYXNzaXZlIGluZm9ybWF0aW9uIGFuZCBjb21tdW5pY2F0aW9uLlwiXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGF5OiAnJyxcclxuICAgICAgICAgIG1vbnRoOiAnSnVuZScsXHJcbiAgICAgICAgICB5ZWFyOiAnMjAxNycsXHJcbiAgICAgICAgICBpbWFnZTogJy9pbWcvbmV3cy9uZXdzMy5qcGcnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICB0aXRsZTogJ1ZzZXZvbG9kIER5b21raW4gYWJvdXQgVmVyaWZpZWQgUHJvdG90eXBlJyxcclxuICAgICAgICAgIHRpdGxlRm90bzonL2ltZy9uZXdzL25ld3MyLXRpdGxlLmpwZycsXHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJWZXJpZmllZCBpcyBhIHByb3RvdHlwZSBvZiB0aGUgcHJvZ3JhbSB0aGF0IGNhbiBkZXRlcm1pbmUgd2hldGhlciB0aGUgbmV3cyBpcyB0cnVlIG9yIGZha2UuIFRoZSBwcm9ncmFtIGNoZWNrcyB0aGUgdGV4dCBmb3IgaW5jb25zaXN0ZW5jaWVzLiBUaGUgcXVlc3Rpb24gaXMuLi5cIixcclxuICAgICAgICAgIGRldGFpbGVkRGVzY3JpcHRpb246IHtcclxuICAgICAgICAgICAgcGFyYWdyYXBoMTogXCJWZXJpZmllZCBpcyBhIHByb3RvdHlwZSBvZiB0aGUgcHJvZ3JhbSB0aGF0IGNhbiBkZXRlcm1pbmUgd2hldGhlciB0aGUgbmV3cyBpcyB0cnVlIG9yIGZha2UuIFRoZSBwcm9ncmFtIGNoZWNrcyB0aGUgdGV4dCBmb3IgaW5jb25zaXN0ZW5jaWVzLiBUaGUgcXVlc3Rpb24gaXMg4oCcSG93IHRoZSBwcm9ncmFtIHdvcmtzP+KAnS4gVGhlcmUgaXMgYSBzcGVjaWFsIGZpZWxkIHRvIGVudGVyIHRoZSB0ZXh0OiBjbGFpbXMgb3IgcXVvdGVzLiBBZnRlciBlbnRlcmluZywgdGhlIHByb3RvdHlwZSBjb21wYXJlcyBpdCB3aXRoIG90aGVyIHdlYiBzb3VyY2VzLlwiLFxyXG4gICAgICAgICAgICBwYXJhZ3JhcGgyOiBcIlRoZSBwcm9ncmFtIGFuYWx5c2VzIGRhdGEgYW5kIGZpbmRzIGNvbmZpcm1hdGlvbiBvciByZWZ1dGF0aW9uLiBBcyB0aGUgcmVzdWx0LCB3ZSBnZXQgaW5mb3JtYXRpb24gdGhhdCBjYW4gY29uZmlybSBvciByZWZ1dGUgdGhpcyBjbGFpbS4gSWYgdGhlIHJlc3VsdCB3YXMgbm90IGZvdW5kLCB0aGUgY2xhaW0gaXMgbm90IGNvbmZpcm1lZC4gVmVyaWZpZWQgZ29hbCBpcyB0byBoZWxwIG91ciBzb2NpZXR5IHRvIGlkZW50aWZ5IHRoZSBmYWtlIG5ld3MgYW5kIGZpbmQgdGhlIHRydXRoLlwiXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZGF5OiAnJyxcclxuICAgICAgICAgIG1vbnRoOiAnTWF5JyxcclxuICAgICAgICAgIHllYXI6ICcyMDE3JyxcclxuICAgICAgICAgIGltYWdlOiAnL2ltZy9uZXdzL25ld3MyLmpwZydcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRpdGxlOiAnVGhlIG1lZXQtdXAg4oCcRmVhdHVyZXMgYW5kIG1vZGVscyBvZiBOTFBcIicsXHJcbiAgICAgICAgICB0aXRsZUZvdG86Jy9pbWcvbmV3cy9uZXdzMS10aXRsZS5qcGcnLFxyXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiVGhlIG1lZXQtdXAgJ1doYXQgZmVhdHVyZXMgYW5kIG1vZGVscyBkbyB3b3JrIGluIE5MUCBhbmQgd2h5JyB3YXMgaGVsZCBvbiBGZWJydWFyeSwgMTAgYnkgVnNldm9sb2QgRHlvbWtpbiwgTGlzcCBFbmdpbmVlciwgaW5kZXBlbmRlbnQgZGV2ZWxvcGVyIGFuZCBleHBlcnQgaW4gTkxQLlwiLFxyXG4gICAgICAgICAgZGV0YWlsZWREZXNjcmlwdGlvbjoge1xyXG4gICAgICAgICAgICBwYXJhZ3JhcGgxOiBcIlRoZSBtZWV0LXVwICdXaGF0IGZlYXR1cmVzIGFuZCBtb2RlbHMgZG8gd29yayBpbiBOTFAgYW5kIHdoeScgd2FzIGhlbGQgb24gRmVicnVhcnksIDEwIGJ5IFZzZXZvbG9kIER5b21raW4sIExpc3AgRW5naW5lZXIsIGluZGVwZW5kZW50IGRldmVsb3BlciBhbmQgZXhwZXJ0IGluIE5MUC5cIixcclxuICAgICAgICAgICAgcGFyYWdyYXBoMjogXCJWc2V2b2xvZCBzcG9rZSBhYm91dCBsaW5lYXIgbW9kZWxzLCByYW5kb20gZm9yZXN0LCBSTk4sIG1vcnBob2xvZ2ljYWwgZmVhdHVyZXMsIDEtaG90IGVuY29kaW5nIGFuZCB3b3JkLWVtYmVkZGluZ3MuIE1lZXQtdXAgd2FzIGludGVuZGVkIG9uIGF1ZGllbmNlIHdpdGggZ29vZCBleHBlcmllbmNlIGluIE1MLCB3aG8gd2FudGVkIHRvIGxlYXJuIG5ldyBpbmZvcm1hdGlvbi5cIlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGRheTogJzEwJyxcclxuICAgICAgICAgIG1vbnRoOiAnRmVicnVhcnknLFxyXG4gICAgICAgICAgeWVhcjogJzIwMTcnLFxyXG4gICAgICAgICAgaW1hZ2U6ICcvaW1nL25ld3MvbmV3czEuanBnJ1xyXG4gICAgICAgIH1cclxuICAgICAgXTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG5ld3M6IG5ld3NcclxuICB9O1xyXG59XHJcbn0pXHJcbihhbmd1bGFyKTtcclxuIiwiKGZ1bmN0aW9uIChhbmd1bGFyKSB7XHJcbiAgXCJ1c2Ugc3RyaWN0XCI7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ1RlYW1TZXJ2aWNlJywgVGVhbVNlcnZpY2UpO1xyXG5cclxuICBUZWFtU2VydmljZS4kaW5qZWN0ID0gW107XHJcblxyXG4gIGZ1bmN0aW9uIFRlYW1TZXJ2aWNlKCkge1xyXG5cclxuICAgIHZhciBkaXJlY3RvcnMgPSBbXHJcbiAgICAgIHsgbmFtZTogJ0RpYW5lIEZyYW5jaXMnLFxyXG4gICAgICAgIHBvc2l0aW9uOidBdXRob3IsIFByb2Zlc3Npb25hbCBDb3Jwb3JhdGUgRGlyZWN0b3IsIFByb2Zlc3NvciwgRW50cmVwcmVuZXVyLCBleHBlcnQgb24gU2lsaWNvbiBWYWxsZXksIGZ1dHVyZSB0ZWNobm9sb2d5JyxcclxuICAgICAgICBpbWFnZTogJ2ZyYW5zaXMuanBnJ1xyXG4gICAgICB9LFxyXG4gICAgICB7IG5hbWU6ICdKYXNvbiBNaXR1cmEnLFxyXG4gICAgICAgIHBvc2l0aW9uOidTZXJpYWwgVmVudHVyZSBDYXBpdGFsaXN0LCBWaWV3ZGxlJyxcclxuICAgICAgICBpbWFnZTogJ2phc29uLmpwZydcclxuICAgICAgfSxcclxuICAgICAgeyBuYW1lOiAnS2lyYVx0UnVkaWsnLFxyXG4gICAgICAgIHBvc2l0aW9uOidNYW5hZ2VtZW50IGFuZCBPcGVyYXRpb25zJyxcclxuICAgICAgICBpbWFnZTogJ2tpcmEuanBnJ1xyXG4gICAgICB9LFxyXG4gICAgICB7IG5hbWU6ICdWc2V2b2xvZCBEeW9ta2luJyxcclxuICAgICAgICBwb3NpdGlvbjonV29ybGQtQ2xhc3MgcmVzZWFyY2hlciwgS3lpdiBQb2x5dGVjaG5pYyBsZWN0dXJlciwgNSB5ZWFycyBOTFAgd2l0aCBHcmFtbWFybHknLFxyXG4gICAgICAgIGltYWdlOiAnZHlvbWtpbi5qcGcnXHJcbiAgICAgIH1cclxuICAgIF07XHJcbiAgICB2YXIgdGVhbSA9IFtcclxuICAgICAgICB7bmFtZTogJ1RhcmFzJywgcG9zaXRpb246J1Jlc2VhcmNoZXInLCBpbWFnZTogJ3RhcmFzLXNlcmVkYS0wMDA2LmpwZyd9LFxyXG4gICAgICAgIHtuYW1lOiAnQWxla3NhbmRyJywgcG9zaXRpb246J0Z1bGwgU3RhY2sgRGV2ZWxvcGVyJywgaW1hZ2U6ICdhbGV4LWxhcHNoeW4uanBnJ31cclxuICAgICAgXTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB0ZWFtOiB0ZWFtLFxyXG4gICAgICBkaXJlY3RvcnM6IGRpcmVjdG9yc1xyXG4gICAgfTtcclxuICB9XHJcbn0pKGFuZ3VsYXIpO1xyXG4iLCIoZnVuY3Rpb24gKGFuZ3VsYXIpIHtcclxuICBcInVzZSBzdHJpY3RcIjtcclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnV2luZG93RXZlbnRzU2VydmljZScsIFdpbmRvd0V2ZW50c1NlcnZpY2UpO1xyXG5cclxuICBXaW5kb3dFdmVudHNTZXJ2aWNlLiRpbmplY3QgPSBbJyR3aW5kb3cnXTtcclxuXHJcbiAgZnVuY3Rpb24gV2luZG93RXZlbnRzU2VydmljZSgkd2luZG93KSB7XHJcbiAgICB2YXIgYXBpID0ge1xyXG4gICAgICB0aHJvdHRsZVRpbWU6IDEwMCxcclxuICAgICAgbGlzdGVuOiBsaXN0ZW5cclxuICAgIH07XHJcblxyXG4gICAgLy9saXN0ZW5lciB1cGRhdGVzXHJcbiAgICBmdW5jdGlvbiBsaXN0ZW4oaXNPbiwgdHlwZSwgbWV0aG9kLCB0aW1lKSB7XHJcblxyXG4gICAgICAvL2NsZWFuIHRpbWUsIGRldGVybWluZSBsaXN0ZW5lciB0eXBlXHJcbiAgICAgIHZhciBkZWJvdW5jZVRpbWUgPSBpc05hTih0aW1lKSA/IGFwaS50aHJvdHRsZVRpbWUgOiB0aW1lLFxyXG4gICAgICAgIGxpc3RlbmVyVHlwZSA9IGlzT24gPyAnYWRkRXZlbnRMaXN0ZW5lcicgOiAncmVtb3ZlRXZlbnRMaXN0ZW5lcic7XHJcblxyXG4gICAgICAvL3VwZGF0ZSB0aHJvdHRsZWQgbGlzdGVuZXJcclxuICAgICAgJHdpbmRvd1tsaXN0ZW5lclR5cGVdKHR5cGUsIF8udGhyb3R0bGUobWV0aG9kLCBkZWJvdW5jZVRpbWUpKTtcclxuICAgIH1cclxuXHJcbiAgICAvL2ludGVyZmFjZVxyXG4gICAgcmV0dXJuIGFwaTtcclxuICB9XHJcbn0pKGFuZ3VsYXIpOyIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ29uU2Nyb2xsJywgZnVuY3Rpb24oJHRpbWVvdXQpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBzY29wZToge1xyXG4gICAgICBvblNjcm9sbDogJyZvblNjcm9sbCcsXHJcbiAgICB9LFxyXG4gICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQpIHtcclxuICAgICAgdmFyIHNjcm9sbERlbGF5ID0gMjUwLFxyXG4gICAgICAgIHNjcm9sbFRocm90dGxlVGltZW91dCxcclxuICAgICAgICB0aHJvdHRsZWQgPSBmYWxzZSxcclxuICAgICAgICBzY3JvbGxIYW5kbGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICBpZiAoIXRocm90dGxlZCkge1xyXG4gICAgICAgICAgICBzY29wZS5vblNjcm9sbCgpO1xyXG4gICAgICAgICAgICB0aHJvdHRsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBzY3JvbGxUaHJvdHRsZVRpbWVvdXQgPSAkdGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgIHRocm90dGxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCBzY3JvbGxEZWxheSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgIGVsZW1lbnQub24oXCJzY3JvbGxcIiwgc2Nyb2xsSGFuZGxlcik7XHJcblxyXG4gICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgZWxlbWVudC5vZmYoJ3Njcm9sbCcsIHNjcm9sbEhhbmRsZXIpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59KTtcclxuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuICAndXNlIHN0cmljdCc7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ0xhbmRpbmdDb250cm9sbGVyJywgTGFuZGluZ0NvbnRyb2xsZXIpO1xyXG5cclxuICBMYW5kaW5nQ29udHJvbGxlci4kaW5qZWN0ID0gWyckaHR0cCcsICdsaW1pdFRvRmlsdGVyJ107XHJcbiAgZnVuY3Rpb24gTGFuZGluZ0NvbnRyb2xsZXIoJGh0dHAsIGxpbWl0VG9GaWx0ZXIpIHtcclxuICAgIHZhciBtYWluID0gdGhpcztcclxuXHJcbiAgICBtYWluLmZvcm1TdWJtaXQgPSBmb3JtU3VibWl0O1xyXG4gICAgbWFpbi5lcnJvciA9ICdzb21ldGhpbmcgd3JvbmcnO1xyXG4gICAgbWFpbi5mb3JtRGF0YSA9IHt9O1xyXG4gICAgbWFpbi5zaG93U3RlcDIgPSBmYWxzZTtcclxuICAgIG1haW4uc2hvd1N0ZXAzID0gZmFsc2U7XHJcblxyXG4gICAgbWFpbi5taW5ZZWFycyA9IDc2NzE7XHJcbiAgICBtYWluLmRpZjcweWVycyA9IDI1NTY5O1xyXG4gICAgbWFpbi50b2RheURhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgbWFpbi50b2RheURheXMgPSAgbWFpbi50b2RheURhdGUuZ2V0VGltZSgpIC8gODY0MDAwMDA7XHJcbiAgICBtYWluLmFnZUNoZWNrID0gYWdlQ2hlY2s7XHJcbiAgICBtYWluLmFnZUludmFsaWQgPSBmYWxzZTtcclxuXHJcbiAgICBtYWluLmdldENpdGllcyA9IGdldENpdGllcztcclxuXHJcbiAgICBmdW5jdGlvbiBhZ2VDaGVjaygpIHtcclxuICAgICAgbWFpbi5pbm5TdHIgPSBtYWluLmZvcm1EYXRhLmlubi50b1N0cmluZygpLnN1YnN0cmluZygwLCA1KTtcclxuICAgICAgbWFpbi5hZ2VDaGVja1JlcyA9IG1haW4udG9kYXlEYXlzICsgbWFpbi5kaWY3MHllcnMgLSBtYWluLmlublN0cjtcclxuICAgICAgaWYgKG1haW4uYWdlQ2hlY2tSZXMgPiAgbWFpbi5taW5ZZWFycykge1xyXG4gICAgICAgIG1haW4uYWdlSW52YWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9ICAgZWxzZSB7XHJcbiAgICAgICAgbWFpbi5hZ2VJbnZhbGlkID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBmb3JtU3VibWl0KCkge1xyXG4gICAgICAkaHR0cCh7XHJcbiAgICAgICAgICB1cmw6ICcvJyxcclxuICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICBkYXRhOiBtYWluLmZvcm1EYXRhLFxyXG4gICAgICAgICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkO2NoYXJzZXQ9dXRmLTg7J31cclxuICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgYWxlcnQoJ2RhdGEgc2VudCcpO1xyXG4gICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjaygpIHtcclxuICAgICAgICAgICAgICBhbGVydChcInNvbWV0aGluZyB3cm9uZ1wiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0Q2l0aWVzKCkge1xyXG4gICAgICAkaHR0cC5nZXQoXCJodHRwOi8vZ2QuZ2VvYnl0ZXMuY29tL0F1dG9Db21wbGV0ZUNpdHk/Y2FsbGJhY2s9PyZxPVwiICsgbWFpbi5mb3JtRGF0YS5jaXR5KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgIG1haW4uY2l0aWVzID0gbGltaXRUb0ZpbHRlcihyZXNwb25zZS5kYXRhLCAxNSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn0pKGFuZ3VsYXIpO1xyXG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKGxhbmRpbmdSb3V0ZSk7XHJcbiAgbGFuZGluZ1JvdXRlLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJ107XHJcblxyXG4gIGZ1bmN0aW9uIGxhbmRpbmdSb3V0ZSgkc3RhdGVQcm92aWRlcikge1xyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2xhbmRpbmcnLCB7XHJcbiAgICAgIGFic3RyYWN0OiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3L21vZHVsZXMvbGFuZGluZy9sYW5kaW5nLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAnTGFuZGluZ0NvbnRyb2xsZXInLFxyXG4gICAgICBjb250cm9sbGVyQXM6ICdtYWluJ1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxufSkoYW5ndWxhcik7XHJcbiIsIihmdW5jdGlvbiAoYW5ndWxhcikge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignTGFuZGluZ0hvbWVDb250cm9sbGVyJywgTGFuZGluZ0hvbWVDb250cm9sbGVyKTtcclxuXHJcblxyXG4gIExhbmRpbmdIb21lQ29udHJvbGxlci4kaW5qZWN0ID0gWyckZG9jdW1lbnQnLCAnJHNjb3BlJywgJyR3aW5kb3cnLCAnV2luZG93RXZlbnRzU2VydmljZScsXHJcbiAgICAnSG9tZVNlcnZpY2UnLCAnJHN0YXRlUGFyYW1zJywgJyR0aW1lb3V0JywgJ1RlYW1TZXJ2aWNlJ107XHJcbiAgZnVuY3Rpb24gTGFuZGluZ0hvbWVDb250cm9sbGVyKCRkb2N1bWVudCwgJHNjb3BlLCAkd2luZG93LCBXaW5kb3dFdmVudHNTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIb21lU2VydmljZSwgJHN0YXRlUGFyYW1zLCAkdGltZW91dCwgVGVhbVNlcnZpY2UpIHtcclxuICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgdm0uc2Nyb2xsVG8gPSBzY3JvbGxUbztcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gc2Nyb2xsVG8oZWxlbWVudEluZGV4KSB7XHJcbiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkZG9jdW1lbnQuc2Nyb2xsVG9FbGVtZW50QW5pbWF0ZWQodm0uc2VjdGlvbnNbZWxlbWVudEluZGV4XS5lbGVtZW50LCAwKTtcclxuICAgICAgfSwgMTAwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRFbGVtZW50c0hlaWdodCgpIHtcclxuICAgICAgdm0uZXZlbnRzR3JpZEhlaWdodCA9IGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXZlbnRzLWdyaWQnKSlbMF0uY2xpZW50SGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG59KShhbmd1bGFyKTtcclxuIiwiKGZ1bmN0aW9uKGFuZ3VsYXIpIHtcclxuICAndXNlIHN0cmljdCc7XHJcbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbmZpZyhsYW5kaW5nSG9tZVJvdXRlKTtcclxuICBsYW5kaW5nSG9tZVJvdXRlLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJ107XHJcblxyXG4gIGZ1bmN0aW9uIGxhbmRpbmdIb21lUm91dGUoJHN0YXRlUHJvdmlkZXIpIHtcclxuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdsYW5kaW5nLmhvbWUnLCB7XHJcbiAgICAgIHVybDogJy8nLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy92aWV3L21vZHVsZXMvbGFuZGluZy9ob21lL2hvbWUuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdMYW5kaW5nSG9tZUNvbnRyb2xsZXInLFxyXG4gICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICB0aXRsZTogJ3Rlc3QgdGFzaydcclxuICAgICAgfSxcclxuICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgdGFyZ2V0U2VjdGlvbk5hbWU6ICdtYWluJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn0pKGFuZ3VsYXIpO1xyXG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignTGFuZGluZ1BhZ2UyQ29udHJvbGxlcicsIExhbmRpbmdQYWdlMkNvbnRyb2xsZXIpO1xyXG5cclxuICBMYW5kaW5nUGFnZTJDb250cm9sbGVyLiRpbmplY3QgPSBbJyRkb2N1bWVudCcsICdXaW5kb3dFdmVudHNTZXJ2aWNlJywgJyR3aW5kb3cnLCAnJHNjb3BlJywgJyR0aW1lb3V0JyxcclxuICAnSG9tZVNlcnZpY2UnLCAnJHN0YXRlUGFyYW1zJ107XHJcbiAgZnVuY3Rpb24gTGFuZGluZ1BhZ2UyQ29udHJvbGxlcigkZG9jdW1lbnQsIFdpbmRvd0V2ZW50c1NlcnZpY2UsICR3aW5kb3csICRzY29wZSwgJHRpbWVvdXQsXHJcbiAgICAgSG9tZVNlcnZpY2UsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICB2bS5zY3JvbGxZID0gMDtcclxuICAgIHZtLm1lbnVJc09wZW4gPSBmYWxzZTtcclxuICAgIHZtLnRvZ2dsZU1vYmlsZU1lbnUgPSB0b2dnbGVNb2JpbGVNZW51O1xyXG4gICAgdm0uc2Nyb2xsVG8gPSBzY3JvbGxUbztcclxuICAgIHZtLndpbmRvd1dpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgdm0ud2luZG93SGVpZ2h0ID0gJHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgIHZtLndpbmRvd1kgPSAwO1xyXG4gICAgdm0ubmV3cyA9IEhvbWVTZXJ2aWNlLm5ld3M7XHJcbiAgICB2bS5uZXdzTGVmdE91dCA9IHZtLndpbmRvd1dpZHRoICogMC4yOTtcclxuICAgIHZtLm5ld3NJdGVtV2lkdGggPSA0MDA7XHJcbiAgICB2bS5uZXdzTGlzdFdpZHRoID0gdm0ubmV3cy5sZW5ndGggKiB2bS5uZXdzSXRlbVdpZHRoO1xyXG4gICAgdm0ubmV3c0xlZnQgPSBuZXdzTGVmdDtcclxuICAgIHZtLm5ld3NSaWdodCA9IG5ld3NSaWdodDtcclxuICAgIHZtLm9wZW5OZXdzID0ge307XHJcbiAgICB2bS5kZXRhaWxlZE5ld3NPcGVuZWQgPSBmYWxzZTtcclxuICAgIHZtLm5ld3NEZXRhbHNUb2dnbGUgPSBuZXdzRGV0YWxzVG9nZ2xlO1xyXG4gICAgdm0ubGVmdEFycm93SG92ZXJlZCA9IGZhbHNlO1xyXG4gICAgdm0ucmlnaHRBcnJvd0hvdmVyZWQgPSBmYWxzZTtcclxuXHJcbiAgICBXaW5kb3dFdmVudHNTZXJ2aWNlLmxpc3Rlbih0cnVlLCAnc2Nyb2xsJywgZGVmaW5lU2Nyb2xsWSk7XHJcblxyXG4gICAgZnVuY3Rpb24gZGVmaW5lU2Nyb2xsWSgpIHtcclxuICAgICAgdm0uc2Nyb2xsWSA9ICR3aW5kb3cuc2Nyb2xsWTtcclxuICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNjcm9sbFRvKHNlY3Rpb25OYW1lKSB7XHJcbiAgICAgICRkb2N1bWVudC5zY3JvbGxUb0VsZW1lbnRBbmltYXRlZCh2bS5zZWN0aW9uc1tzZWN0aW9uTmFtZV0uZWxlbWVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdG9nZ2xlTW9iaWxlTWVudSgpIHtcclxuICAgICAgdm0ubWVudUlzT3BlbiA9ICF2bS5tZW51SXNPcGVuO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBpZiAodm0ud2luZG93V2lkdGggPCA3MDApIHtcclxuICAgICAgdm0ubmV3c0xlZnRPdXQgPSAyO1xyXG4gICAgICB2bS5uZXdzSXRlbVdpZHRoID0gMzMwO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGNoZWNrV2luZG93V2lkdGgoKXtcclxuICAgICAgICB2bS53aW5kb3dXaWR0aCA9ICR3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICAkdGltZW91dCggY2hlY2tXaW5kb3dXaWR0aCwgMjAwICk7XHJcbiAgICB9XHJcbiAgICBjaGVja1dpbmRvd1dpZHRoKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gZXZlbnREZXRhaWxzKGV2ZW50KSB7XHJcbiAgICAgIHZtLnNlbGVjdGVkRXZlbnQgPSBldmVudDtcclxuICAgICAgdm0uc2hvd0V2ZW50RGV0YWlscyA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbmV3c0xlZnQoKSB7XHJcbiAgICAgIGlmICh2bS53aW5kb3dXaWR0aCA+IDcwMCkge1xyXG4gICAgICAgIGlmKCAgKHZtLm5ld3NMaXN0V2lkdGggKyB2bS5uZXdzTGVmdE91dCkgPCAodm0ubmV3c0l0ZW1XaWR0aCAqIDIuNSkgICkge1xyXG4gICAgICAgICAgdm0ubmV3c0xlZnRPdXQgPSB2bS53aW5kb3dXaWR0aCAqIDAuMjk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHZtLm5ld3NMZWZ0T3V0IC09IHZtLm5ld3NJdGVtV2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmKCAgKHZtLm5ld3NMaXN0V2lkdGggKyB2bS5uZXdzTGVmdE91dCkgPCAodm0ubmV3c0l0ZW1XaWR0aCoyLjUpICApIHtcclxuICAgICAgICAgIHZtLm5ld3NMZWZ0T3V0ID0gMjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdm0ubmV3c0xlZnRPdXQgLT0gdm0ubmV3c0l0ZW1XaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBuZXdzUmlnaHQoKSB7XHJcbiAgICAgIGlmICh2bS53aW5kb3dXaWR0aCA+IDcwMCkge1xyXG4gICAgICAgIGlmKCAgKHZtLm5ld3NMZWZ0T3V0L3ZtLndpbmRvd1dpZHRoKSA+IDAuNzMgICkge1xyXG4gICAgICAgICAgdm0ubmV3c0xlZnRPdXQgPSB2bS53aW5kb3dXaWR0aCAqIDAuMjk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHZtLm5ld3NMZWZ0T3V0ICs9IHZtLm5ld3NJdGVtV2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmKCAgdm0ubmV3c0xlZnRPdXQgPCAzICYmIHZtLm5ld3NMZWZ0T3V0ID4gLTEwMCAgKSB7XHJcbiAgICAgICAgICB2bS5uZXdzTGVmdE91dCA9IC0gdm0ubmV3c0l0ZW1XaWR0aCAqICh2bS5uZXdzLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB2bS5uZXdzTGVmdE91dCArPSB2bS5uZXdzSXRlbVdpZHRoO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIG5ld3NEZXRhbHNUb2dnbGUoKSB7XHJcbiAgICAgICB2bS5kZXRhaWxlZE5ld3NPcGVuZWQgPSAhdm0uZGV0YWlsZWROZXdzT3BlbmVkO1xyXG4gICAgfVxyXG5cclxuICB9XHJcbn0pKGFuZ3VsYXIpO1xyXG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKGxhbmRpbmdQYWdlMlJvdXRlKTtcclxuICBsYW5kaW5nUGFnZTJSb3V0ZS4kaW5qZWN0ID0gWyckc3RhdGVQcm92aWRlciddO1xyXG5cclxuICBmdW5jdGlvbiBsYW5kaW5nUGFnZTJSb3V0ZSgkc3RhdGVQcm92aWRlcikge1xyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2xhbmRpbmcucGFnZTInLCB7XHJcbiAgICAgIHVybDogJy9wYWdlMicsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXcvbW9kdWxlcy9sYW5kaW5nL3BhZ2UyL3BhZ2UyLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAnTGFuZGluZ1BhZ2UyQ29udHJvbGxlcicsXHJcbiAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIHRpdGxlOiAncGFnZSAyJ1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbn0pKGFuZ3VsYXIpO1xyXG4iLCIoZnVuY3Rpb24oYW5ndWxhcikge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignTGFuZGluZ1BhZ2UzQ29udHJvbGxlcicsIExhbmRpbmdQYWdlM0NvbnRyb2xsZXIpO1xyXG5cclxuICBMYW5kaW5nUGFnZTNDb250cm9sbGVyLiRpbmplY3QgPSBbJyRkb2N1bWVudCcsICdXaW5kb3dFdmVudHNTZXJ2aWNlJywgJyR3aW5kb3cnLCAnJHNjb3BlJywgJyR0aW1lb3V0JyxcclxuICAnVGVhbVNlcnZpY2UnLCAnJHN0YXRlUGFyYW1zJ107XHJcbiAgZnVuY3Rpb24gTGFuZGluZ1BhZ2UzQ29udHJvbGxlcigkZG9jdW1lbnQsIFdpbmRvd0V2ZW50c1NlcnZpY2UsICR3aW5kb3csICRzY29wZSwgJHRpbWVvdXQsXHJcbiAgICAgVGVhbVNlcnZpY2UsICRzdGF0ZVBhcmFtcykge1xyXG4gICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICB2bS5zY3JvbGxZID0gMDtcclxuICAgIHZtLm1lbnVJc09wZW4gPSBmYWxzZTtcclxuICAgIHZtLnRvZ2dsZU1vYmlsZU1lbnUgPSB0b2dnbGVNb2JpbGVNZW51O1xyXG4gICAgdm0uc2Nyb2xsVG8gPSBzY3JvbGxUbztcclxuICAgIHZtLndpbmRvd1dpZHRoID0gJHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgdm0ud2luZG93SGVpZ2h0ID0gJHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgIHZtLndpbmRvd1kgPSAwO1xyXG4gICAgdm0uZGlyZWN0b3JzID0gVGVhbVNlcnZpY2UuZGlyZWN0b3JzO1xyXG4gICAgdm0uc3RhZmYgPSBUZWFtU2VydmljZS50ZWFtO1xyXG5cclxuICAgIFdpbmRvd0V2ZW50c1NlcnZpY2UubGlzdGVuKHRydWUsICdzY3JvbGwnLCBkZWZpbmVTY3JvbGxZKTtcclxuXHJcbiAgICBmdW5jdGlvbiBkZWZpbmVTY3JvbGxZKCkge1xyXG4gICAgICB2bS5zY3JvbGxZID0gJHdpbmRvdy5zY3JvbGxZO1xyXG4gICAgICAkc2NvcGUuJGFwcGx5KCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2Nyb2xsVG8oc2VjdGlvbk5hbWUpIHtcclxuICAgICAgJGRvY3VtZW50LnNjcm9sbFRvRWxlbWVudEFuaW1hdGVkKHZtLnNlY3Rpb25zW3NlY3Rpb25OYW1lXS5lbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiB0b2dnbGVNb2JpbGVNZW51KCkge1xyXG4gICAgICB2bS5tZW51SXNPcGVuID0gIXZtLm1lbnVJc09wZW47XHJcbiAgICB9XHJcblxyXG4gIH1cclxufSkoYW5ndWxhcik7XHJcbiIsIihmdW5jdGlvbihhbmd1bGFyKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcobGFuZGluZ1BhZ2UzUm91dGUpO1xyXG4gIGxhbmRpbmdQYWdlM1JvdXRlLiRpbmplY3QgPSBbJyRzdGF0ZVByb3ZpZGVyJ107XHJcblxyXG4gIGZ1bmN0aW9uIGxhbmRpbmdQYWdlM1JvdXRlKCRzdGF0ZVByb3ZpZGVyKSB7XHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbGFuZGluZy5wYWdlMycsIHtcclxuICAgICAgdXJsOiAnL3BhZ2UzJyxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvdmlldy9tb2R1bGVzL2xhbmRpbmcvcGFnZTMvcGFnZTMuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdMYW5kaW5nUGFnZTNDb250cm9sbGVyJyxcclxuICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgdGl0bGU6ICdwYWdlIDMnXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxufSkoYW5ndWxhcik7XHJcbiJdfQ==
